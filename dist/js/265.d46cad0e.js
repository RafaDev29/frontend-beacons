"use strict";(self["webpackChunkfrontend_ebox_platform"]=self["webpackChunkfrontend_ebox_platform"]||[]).push([[265],{4265:function(e,t,a){a.r(t),a.d(t,{default:function(){return pe}});var o=a(6768),r=a(5130),n=a(4232);const l={class:"relative p-6"},s={class:"flex justify-between items-center mb-6"},i=(0,o.Lk)("h1",{class:"text-3xl font-bold text-gray-800"},"Monitoreo en Tiempo Real",-1),c={class:"relative mb-6"},d={key:0,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow mt-1"},u=["onClick"],g={class:"text-gray-500 text-sm"},h={key:0,class:"text-center text-gray-500"},p=(0,o.Lk)("p",null,"Cargando datos de monitoreo...",-1),m=[p],v={key:1,class:"text-center text-red-500"},y={key:2},b={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},f={key:1,class:"text-center text-gray-500 text-sm mt-6"},x={key:0,class:"fixed top-0 right-0 h-full w-96 bg-white shadow-xl z-50 border-l border-gray-300 flex flex-col"},k={class:"p-6 border-b border-gray-200 flex justify-between items-center"},L={class:"text-lg font-semibold text-gray-800"},B={class:"p-6 space-y-4 flex-1 overflow-y-auto"},C={class:"text-sm text-gray-500"},E=(0,o.Lk)("strong",null,"MAC:",-1),w={class:"text-sm text-gray-500"},_=(0,o.Lk)("strong",null,"RSSI:",-1),X={class:"text-sm text-gray-500"},M=(0,o.Lk)("strong",null,"Proxy:",-1),R={class:"text-sm text-gray-500"},S=(0,o.Lk)("strong",null,"Email:",-1),A={class:"text-sm text-gray-500"},I=(0,o.Lk)("strong",null,"Teléfono:",-1);function F(e,t,a,p,F,K){const D=(0,o.g2)("MonitoringLayout");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("div",s,[i,(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>p.fetchMonitoringData&&p.fetchMonitoringData(...e)),class:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition"}," Recargar Datos ")]),(0,o.Lk)("div",c,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.searchQuery=e),onInput:t[2]||(t[2]=(...e)=>p.updateSearchResults&&p.updateSearchResults(...e)),type:"text",placeholder:"Buscar beacons por nombre...",class:"w-full border border-gray-300 rounded-lg px-4 py-2 text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[r.Jo,p.searchQuery]]),p.searchResults.length>0&&p.searchQuery.length>0?((0,o.uX)(),(0,o.CE)("ul",d,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(p.searchResults,(e=>((0,o.uX)(),(0,o.CE)("li",{key:e.id,onClick:t=>p.selectBeaconFromSearch(e.id),class:"px-4 py-2 hover:bg-blue-100 cursor-pointer flex justify-between"},[(0,o.Lk)("span",null,(0,n.v_)(e.name),1),(0,o.Lk)("span",g,(0,n.v_)(e.proxyPhone),1)],8,u)))),128))])):(0,o.Q3)("",!0)]),p.loading?((0,o.uX)(),(0,o.CE)("div",h,m)):p.error?((0,o.uX)(),(0,o.CE)("div",v,[(0,o.Lk)("p",null,"Error al cargar datos: "+(0,n.v_)(p.error),1)])):((0,o.uX)(),(0,o.CE)("div",y,[p.filteredLayouts.length>0?((0,o.uX)(),(0,o.CE)("div",b,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(p.filteredLayouts,(e=>((0,o.uX)(),(0,o.Wv)(D,{key:e._id,layout:e,onBeaconSelected:p.selectBeacon,highlightedBeacon:p.highlightedBeacon},null,8,["layout","onBeaconSelected","highlightedBeacon"])))),128))])):((0,o.uX)(),(0,o.CE)("div",f," No se encontraron beacons que coincidan con la búsqueda. "))])),(0,o.bF)(r.eB,{name:"slide",mode:"out-in"},{default:(0,o.k6)((()=>[p.selectedBeacon?((0,o.uX)(),(0,o.CE)("div",x,[(0,o.Lk)("div",k,[(0,o.Lk)("h2",L,(0,n.v_)(p.selectedBeacon.name),1),(0,o.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>p.closePanel&&p.closePanel(...e)),class:"text-gray-400 hover:text-red-500 transition"}," ✕ ")]),(0,o.Lk)("div",B,[(0,o.Lk)("p",C,[E,(0,o.eW)(" "+(0,n.v_)(p.selectedBeacon.mac),1)]),(0,o.Lk)("p",w,[_,(0,o.eW)(" "+(0,n.v_)(p.selectedBeacon.RSSI),1)]),(0,o.Lk)("p",X,[M,(0,o.eW)(" "+(0,n.v_)(p.selectedBeacon.proxyName),1)]),(0,o.Lk)("p",R,[S,(0,o.eW)(" "+(0,n.v_)(p.selectedBeacon.proxyEmail),1)]),(0,o.Lk)("p",A,[I,(0,o.eW)(" "+(0,n.v_)(p.selectedBeacon.proxyPhone),1)])])])):(0,o.Q3)("",!0)])),_:1})])}var K=a(144),D=a(1189);const j="http://198.211.99.223:3000/api/v1";function W(e){return D.A.get(`${j}/monitoring`,{headers:{Authorization:`Bearer ${e}`}})}var P=a(5129);const Q=e=>((0,o.Qi)("data-v-60217f97"),e=e(),(0,o.jt)(),e),T={class:"border border-gray-300 rounded-lg shadow-lg mb-6 bg-gray-50 transition duration-300 hover:shadow-xl"},q={class:"bg-blue-600 text-white p-4 rounded-t-lg flex justify-between items-center"},N={class:"text-lg font-bold"},$={class:"text-sm"},z=Q((()=>(0,o.Lk)("span",{class:"font-medium"},"Áreas:",-1))),O={class:"p-4 flex flex-wrap gap-4"};function V(e,t,a,r,l,s){const i=(0,o.g2)("MonitoringArea");return(0,o.uX)(),(0,o.CE)("div",T,[(0,o.Lk)("div",q,[(0,o.Lk)("h2",N,(0,n.v_)(a.layout.name),1),(0,o.Lk)("div",$,[z,(0,o.eW)(" "+(0,n.v_)(a.layout.areas.length),1)])]),(0,o.Lk)("div",O,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.layout.areas,((r,n)=>((0,o.uX)(),(0,o.CE)("div",{key:r._id,class:"mb-4"},[(0,o.bF)(i,{area:r,areaIndex:n,highlightedBeacon:a.highlightedBeacon,onBeaconSelected:t[0]||(t[0]=t=>e.$emit("beaconSelected",t))},null,8,["area","areaIndex","highlightedBeacon"])])))),128))])])}const J={class:"p-4 rounded-t-lg"},U={class:"text-md font-medium text-gray-800"},G={key:0,class:"p-4 grid grid-cols-2 md:grid-cols-3 gap-4"},H={key:1,class:"p-4 text-center text-gray-500 text-sm"};function Y(e,t,a,r,l,s){const i=(0,o.g2)("MonitoringBeacon");return(0,o.uX)(),(0,o.CE)("div",{class:"border border-gray-200 rounded-lg shadow-md hover:bg-gray-100 transition duration-300",style:(0,n.Tr)({background:r.getBackgroundColor(a.areaIndex)})},[(0,o.Lk)("div",J,[(0,o.Lk)("h3",U,(0,n.v_)(a.area.name),1)]),a.area.items.length>0?((0,o.uX)(),(0,o.CE)("div",G,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.area.items,(e=>((0,o.uX)(),(0,o.Wv)(i,{key:e._id,beacon:e,highlighted:a.highlightedBeacon===e._id,onClick:t=>r.selectBeacon(e)},null,8,["beacon","highlighted","onClick"])))),128))])):((0,o.uX)(),(0,o.CE)("div",H," No hay beacons en esta área. "))],4)}const Z={class:"relative"},ee={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-3 py-1 bg-black text-white text-sm font-medium rounded-md"};function te(e,t,a,r,l,s){return(0,o.uX)(),(0,o.CE)("div",Z,[(0,o.Lk)("div",{class:(0,n.C4)(["w-12 h-12 flex items-center justify-center rounded-full shadow-inner cursor-pointer transition duration-300",{"bg-blue-100 hover:bg-blue-200":!a.highlighted,"animate-flash":a.highlighted}]),onClick:t[0]||(t[0]=t=>e.$emit("click")),onMouseover:t[1]||(t[1]=e=>l.showTooltip=!0),onMouseleave:t[2]||(t[2]=e=>l.showTooltip=!1)},[(0,o.Lk)("i",{class:(0,n.C4)([a.beacon.icon,"text-2xl text-blue-600"])},null,2)],34),l.showTooltip?((0,o.uX)(),(0,o.CE)("div",ee,(0,n.v_)(a.beacon.name),1)):(0,o.Q3)("",!0)])}var ae={name:"MonitoringBeacon",props:{beacon:{type:Object,required:!0},highlighted:{type:Boolean,default:!1}},data(){return{showTooltip:!1}}},oe=a(1241);const re=(0,oe.A)(ae,[["render",te],["__scopeId","data-v-78881c22"]]);var ne=re,le={name:"MonitoringArea",props:{area:{type:Object,required:!0},areaIndex:{type:Number,required:!0},highlightedBeacon:{type:String,default:null}},components:{MonitoringBeacon:ne},setup(e,{emit:t}){const a=["linear-gradient(to right, #DED93A, #EEA735)","linear-gradient(to right, #09bdf7, #3ADEC6)","linear-gradient(to right, #40EFEF, #34B6E5)","linear-gradient(to right, #D0A6F4, #B06BED)","linear-gradient(to right, #EDAE6B, #EF9B40)"],o=e=>a[e%a.length],r=e=>{t("beaconSelected",e)};return{getBackgroundColor:o,selectBeacon:r}}};const se=(0,oe.A)(le,[["render",Y],["__scopeId","data-v-ad2f6782"]]);var ie=se,ce={name:"MonitoringLayout",props:{layout:{type:Object,required:!0},highlightedBeacon:{type:String,default:null}},components:{MonitoringArea:ie}};const de=(0,oe.A)(ce,[["render",V],["__scopeId","data-v-60217f97"]]);var ue=de,ge={name:"MonitoringView",components:{MonitoringLayout:ue},setup(){const e=(0,K.KR)(null),t=(0,K.KR)(!1),a=(0,K.KR)(null),r=(0,K.KR)([]),n=(0,K.KR)(null),l=(0,K.KR)(""),s=(0,K.KR)([]),i=(0,K.KR)(""),c=async()=>{t.value=!0,a.value=null;try{const e=P.A.state.token,t=await W(e);r.value=t.data.data}catch(e){console.error("Error al obtener datos de monitoreo:",e),a.value=e.message||"Error desconocido"}finally{t.value=!1}},d=()=>{if(!l.value.trim())return s.value=[],void(i.value="");const e=l.value.toLowerCase(),t=r.value.flatMap((e=>e.areas.flatMap((e=>e.items))));s.value=t.filter((t=>t.name.toLowerCase().includes(e))).map((e=>({id:e._id,name:e.name,proxyPhone:e.proxyPhone})))},u=(0,o.EW)((()=>{if(!i.value.trim())return r.value;const e=i.value.toLowerCase();return r.value.map((t=>({...t,areas:t.areas.map((t=>({...t,items:t.items.filter((t=>t.name.toLowerCase()===e))}))).filter((e=>e.items.length>0))}))).filter((e=>e.areas.length>0))})),g=t=>{const a=r.value.flatMap((e=>e.areas.flatMap((e=>e.items)))).find((e=>e._id===t));a&&(e.value=a._id,setTimeout((()=>e.value=null),3e3)),l.value="",s.value=[]},h=e=>{n.value=e},p=()=>{n.value=null};return(0,o.sV)((()=>{c()})),{loading:t,error:a,layouts:r,selectedBeacon:n,searchQuery:l,searchResults:s,selectedSearchResult:i,filteredLayouts:u,updateSearchResults:d,selectBeaconFromSearch:g,selectBeacon:h,closePanel:p,fetchMonitoringData:c,highlightedBeacon:e}}};const he=(0,oe.A)(ge,[["render",F]]);var pe=he}}]);
//# sourceMappingURL=265.d46cad0e.js.map